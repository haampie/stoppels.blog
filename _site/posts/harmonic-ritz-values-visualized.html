<!doctype html> <html lang="en"> <head> <meta charset="utf-8"> <meta http-equiv="x-ua-compatible" content="ie=edge"> <title>Harmonic Ritz values visualized | Harmen Stoppels</title> <meta name="description" content="A hopefully insightful visualizion of harmonic Ritz values versus ordinary Ritz values."> <meta name="viewport" content="width=device-width, initial-scale=1"> <meta property="og:title" content="Harmonic Ritz values visualized"> <meta property="og:type" content="website"> <meta property="og:url" content="http://stoppels.blog/posts/harmonic-ritz-values-visualized"> <meta property="og:description" content="A hopefully insightful visualizion of harmonic Ritz values versus ordinary Ritz values."> <meta property="og:site_name" content="Harmen Stoppels"> <meta property="og:image" content="http://stoppels.blog/assets/logo-c03d5362cd6e2bf1b8be92b4c0763645311d085017850c7fe3a832d334768232.png"> <meta property="og:image:type" content="image/png"> <meta property="og:image:width" content="1200"> <meta property="og:image:height" content="630"> <meta name="twitter:card" content="summary"> <meta name="twitter:url" content="http://stoppels.blog/posts/harmonic-ritz-values-visualized"> <meta name="twitter:title" content="Harmonic Ritz values visualized"> <meta name="twitter:description" content="A hopefully insightful visualizion of harmonic Ritz values versus ordinary Ritz values."> <meta name="twitter:image" content="http://stoppels.blog/assets/logo-c03d5362cd6e2bf1b8be92b4c0763645311d085017850c7fe3a832d334768232.png"> <link rel="apple-touch-icon" href="/assets/touch-icon-5fb2a3f5fa8c8d82a463d456ac78e3d475ee9c0803f7a91f875fd8fa0a763100.png"> <link href="http://stoppels.blog/feed.xml" type="application/rss+xml" rel="alternate" title="Harmen Stoppels Last 10 blog posts"/> <style>html{font-family:sans-serif;line-height:1.15;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,footer,header,nav{display:block}h1{font-size:2em;margin:0.67em 0}figure,main{display:block}figure{margin:1em 40px}pre{font-family:monospace, monospace;font-size:1em}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}code{font-family:monospace, monospace;font-size:1em}img{border-style:none}svg:not(:root){overflow:hidden}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}*,*::before,*::after{-webkit-box-sizing:border-box;box-sizing:border-box}html{font-size:16px}body{margin:0 auto;font-family:Arial, Helvetica, sans-serif;-webkit-font-smoothing:antialiased;font-weight:400;line-height:1.8;color:#615b5b;background:#fff1e0}p{margin:0;font-weight:400}h1{margin:0;line-height:1.5;text-rendering:optimizeLegibility}h1{font-size:25.6px;font-weight:400;letter-spacing:-.03em;color:#121111}@media all and (max-width: 767px){h1{font-size:24px}}a{color:#615b5b;text-decoration:underline;-webkit-transition:color 0.2s linear;transition:color 0.2s linear}a:hover,a:active{color:#393636}a:focus{color:#393636;outline:none}ul{padding-left:40px;margin:0}img{display:block;max-width:100%;margin:0}::-moz-selection{color:#fff;background-color:#121111}::selection{color:#fff;background-color:#121111}.footer{display:block;padding:35px 0 85px;border-top:1px solid rgba(0,0,0,0.1)}.footer p{font-size:15px;color:#ada8a8}.grid{display:block;padding:0;margin:0 -20px;font-size:0;text-align:left}.grid-cell{display:inline-block;width:100%;padding:0 20px;margin:0;font-size:16px;text-align:left;vertical-align:top}.grid-centered{max-width:650px;margin-right:auto;margin-left:auto}.article{display:block;margin:100px 0}.article-list-footer{display:block}.article-list-footer span,.article-list-footer a{display:inline-block;font-size:12px;color:#888181;text-transform:uppercase;vertical-align:middle}.article-list-footer a{margin-right:7.5px;color:#615b5b}.article-list-footer a:hover{color:#121111}.article-list-footer a:last-child{margin-right:0}.article-list-divider{margin:0 15px}.article-list-tags{display:inline-block;vertical-align:top}.article-header{display:block;padding-bottom:30px;margin-bottom:30px;border-bottom:1px solid rgba(0,0,0,0.1)}.article-header p{display:block;margin:12px 0 10px;font-size:15px;color:#615b5b}.article-header a{text-decoration:none}.article-content{display:block}.article-content p,.article-content img{display:block;margin-bottom:30px}.article-share{display:block;margin-top:-4px}.article-share a{display:inline-block;margin-right:12px;vertical-align:middle}.article-share a svg{vertical-align:middle;-webkit-transition:fill 0.2s linear;transition:fill 0.2s linear;fill:#ada8a8}.article-share a:hover svg{fill:#615b5b}@media all and (max-width: 767px){.article-list-footer{display:block}.article-list-divider:last-of-type{display:none}.article-list-tags{display:block;margin-top:-7px}}.header-nav{display:block;padding:75px 0 20px;border-bottom:1px solid rgba(0,0,0,0.1)}.header-logo{display:inline-block;font-family:"Palatino Linotype", "Book Antiqua", Palatino, serif;font-size:36px;font-weight:700;color:#000;text-decoration:none}.header-links{float:right;padding:0;margin:15px 0 0;list-style:none}.header-links li{display:inline-block;margin-left:20px;vertical-align:middle}.header-links li:first-child{margin-left:0}.header-links li a{font-size:18px;color:#393636}.header-links li a:hover{color:#121111}@media all and (max-width: 415px){.header-nav{text-align:center}.header-links{display:block;float:none;text-align:center}.header-links li{margin:0 10px}.header-links li:last-child{margin-right:0}}.highlight{padding:50px;margin:0;margin:30px 0;overflow:auto;font-weight:400;background:#f3dec8;-webkit-box-shadow:0 2px 0.2px rgba(0,0,0,0.1);box-shadow:0 2px 0.2px rgba(0,0,0,0.1)}.highlight pre{margin:0}@media all and (max-width: 767px){.highlight{padding:50px 25px;font-size:14px}}.highlight .err{color:#a61717;background-color:#e3d2d2}.highlight .k{font-weight:bold}.highlight .o{font-weight:bold}.highlight .nf{font-weight:bold;color:#900}.highlight .mf{color:#099}.highlight .mi{color:#099}.icon{display:inline-block;width:1em;height:1em;stroke-width:0;stroke:currentColor;fill:currentColor}.icon-ion-social-rss{width:0.75em}.icon-ion-android-person{width:0.75em}</style> <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.6.0/katex.min.css"> </head> <body> <main role="main"> <div class="grid grid-centered"> <div class="grid-cell"> <nav class="header-nav reveal"> <a href="/" class="header-logo" title="Harmen Stoppels">Harmen Stoppels</a> <ul class="header-links"> <li> <a href="/about" title="About me"> <svg class="icon icon-ion-android-person"><use xlink:href="#icon-ion-android-person"></use></svg> </a> </li> <li> <a href="/feed.xml" target="_blank" title="RSS"> <svg class="icon icon-ion-social-rss"><use xlink:href="#icon-ion-social-rss"></use></svg> </a> </li> </ul> </nav> <article class="article reveal"> <header class="article-header"> <h1>Harmonic Ritz values visualized</h1> <p>A hopefully insightful visualizion of harmonic Ritz values versus ordinary Ritz values.</p> <div class="article-list-footer"> <span class="article-list-date"> June 7, 2017 </span> <span class="article-list-divider">-</span> <span class="article-list-minutes"> 11 minute read </span> <span class="article-list-divider">-</span> <div class="article-list-tags"> <a href="/tag/gsoc">gsoc</a> <a href="/tag/julia">julia</a> </div> </div> </header> <div class="article-content"> <p>I thought it would be nice to clarify the previous post with some plots. Take a simple Poisson matrix <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit">A</span></span></span></span> of size <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi><mo>×</mo><mi>n</mi></mrow><annotation encoding="application/x-tex">n \times n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.58333em;"></span><span class="strut bottom" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="base textstyle uncramped"><span class="mord mathit">n</span><span class="mbin">×</span><span class="mord mathit">n</span></span></span></span> with entries <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mrow><mo fence="true">[</mo><mtable><mtr><mtd><mrow><mo>−</mo><mn>1</mn></mrow></mtd><mtd><mrow><mn>2</mn></mrow></mtd><mtd><mrow><mo>−</mo><mn>1</mn></mrow></mtd></mtr></mtable><mo fence="true">]</mo></mrow></mrow><annotation encoding="application/x-tex">\begin{bmatrix}-1 &amp; 2 &amp; -1\end{bmatrix}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.8500000000000001em;"></span><span class="strut bottom" style="height:1.20001em;vertical-align:-0.35001em;"></span><span class="base textstyle uncramped"><span class="minner textstyle uncramped"><span class="style-wrap reset-textstyle textstyle uncramped" style="top:0em;"><span class="delimsizing size1">[</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist"><span style="top:-0.010000000000000009em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord textstyle uncramped"><span class="mord">−</span><span class="mord mathrm">1</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist"><span style="top:-0.010000000000000009em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord textstyle uncramped"><span class="mord mathrm">2</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist"><span style="top:-0.010000000000000009em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord textstyle uncramped"><span class="mord">−</span><span class="mord mathrm">1</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span><span class="style-wrap reset-textstyle textstyle uncramped" style="top:0em;"><span class="delimsizing size1">]</span></span></span></span></span></span> on the diagonals. We know its eigenvalues are all concentrated in the interval <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>[</mo><mn>0</mn><mo separator="true">,</mo><mn>4</mn><mo>]</mo></mrow><annotation encoding="application/x-tex">[0, 4]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mopen">[</span><span class="mord mathrm">0</span><span class="mpunct">,</span><span class="mord mathrm">4</span><span class="mclose">]</span></span></span></span> on the real line.</p> <p>As a preliminary note: I’m not exploiting the symmetry of the matrix in my code. I want to test it on general matrices as well.</p> <p>At any rate, in Julia we generate this Poisson matrix as</p> <figure class="highlight"><pre><code class="language-julia" data-lang="julia"><span class="n">my_matrix</span><span class="x">(</span><span class="n">n</span><span class="x">)</span> <span class="o">=</span> <span class="n">SymTridiagonal</span><span class="x">(</span><span class="n">fill</span><span class="x">(</span><span class="mf">2.0</span><span class="x">,</span> <span class="n">n</span><span class="x">),</span> <span class="n">fill</span><span class="x">(</span><span class="o">-</span><span class="mf">1.0</span><span class="x">,</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="x">))</span></code></pre></figure> <p>Sometimes Jacobi-Davidson’s search space is initialized with the search space of Arnoldi’s method, namely a Krylov subspace with a random initial vector <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>v</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">v_0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">v</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03588em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathrm">0</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span>:</p> <p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mrow><mi mathvariant="script">V</mi></mrow><mo>=</mo><msub><mrow><mi mathvariant="script">K</mi></mrow><mi>k</mi></msub><mo>(</mo><mi>A</mi><mo separator="true">,</mo><msub><mi>v</mi><mn>0</mn></msub><mo>)</mo><mo>=</mo><mi>s</mi><mi>p</mi><mi>a</mi><mi>n</mi><mo>{</mo><msub><mi>v</mi><mn>0</mn></msub><mo separator="true">,</mo><mi>A</mi><msub><mi>v</mi><mn>0</mn></msub><mo separator="true">,</mo><mo>⋯</mo><mo separator="true">,</mo><msup><mi>A</mi><mrow><mi>k</mi><mo>−</mo><mn>1</mn></mrow></msup><msub><mi>v</mi><mn>0</mn></msub><mo>}</mo><mi mathvariant="normal">.</mi></mrow><annotation encoding="application/x-tex"> \mathcal{V} = \mathcal{K}_k(A, v_0) = span\{v_0, Av_0, \cdots, A^{k-1}v_0\}. </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.899108em;"></span><span class="strut bottom" style="height:1.149108em;vertical-align:-0.25em;"></span><span class="base displaystyle textstyle uncramped"><span class="mord displaystyle textstyle uncramped"><span class="mord mathcal" style="margin-right:0.08222em;">V</span></span><span class="mrel">=</span><span class=""><span class="mord displaystyle textstyle uncramped"><span class="mord mathcal" style="margin-right:0.01445em;">K</span></span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit" style="margin-right:0.03148em;">k</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mopen">(</span><span class="mord mathit">A</span><span class="mpunct">,</span><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">v</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03588em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathrm">0</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mclose">)</span><span class="mrel">=</span><span class="mord mathit">s</span><span class="mord mathit">p</span><span class="mord mathit">a</span><span class="mord mathit">n</span><span class="mopen">{</span><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">v</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03588em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathrm">0</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mpunct">,</span><span class="mord mathit">A</span><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">v</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03588em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathrm">0</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mpunct">,</span><span class="minner">⋯</span><span class="mpunct">,</span><span class="mord"><span class="mord mathit">A</span><span class="vlist"><span style="top:-0.41300000000000003em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord scriptstyle uncramped"><span class="mord mathit" style="margin-right:0.03148em;">k</span><span class="mbin">−</span><span class="mord mathrm">1</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">v</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03588em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathrm">0</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mclose">}</span><span class="mord mathrm">.</span></span></span></span></span></p> <p>The well-known Arnoldi decomposition <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>A</mi><msub><mi>V</mi><mi>k</mi></msub><mo>=</mo><msub><mi>V</mi><mrow><mi>k</mi><mo>+</mo><mn>1</mn></mrow></msub><msub><mi>H</mi><mrow><mi>k</mi><mo>+</mo><mn>1</mn><mo separator="true">,</mo><mi>k</mi></mrow></msub></mrow><annotation encoding="application/x-tex">AV_k = V_{k+1}H_{k+1,k}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.969438em;vertical-align:-0.286108em;"></span><span class="base textstyle uncramped"><span class="mord mathit">A</span><span class="mord"><span class="mord mathit" style="margin-right:0.22222em;">V</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.22222em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit" style="margin-right:0.03148em;">k</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mrel">=</span><span class="mord"><span class="mord mathit" style="margin-right:0.22222em;">V</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.22222em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit" style="margin-right:0.03148em;">k</span><span class="mbin">+</span><span class="mord mathrm">1</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mord"><span class="mord mathit" style="margin-right:0.08125em;">H</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.08125em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit" style="margin-right:0.03148em;">k</span><span class="mbin">+</span><span class="mord mathrm">1</span><span class="mpunct">,</span><span class="mord mathit" style="margin-right:0.03148em;">k</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span> gives us an orthonormal matrix <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>V</mi><mi>k</mi></msub></mrow><annotation encoding="application/x-tex">V_k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.22222em;">V</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.22222em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit" style="margin-right:0.03148em;">k</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span> whose <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.69444em;"></span><span class="strut bottom" style="height:0.69444em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.03148em;">k</span></span></span></span> columns span the search space, and a Hessenberg matrix of size <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>(</mo><mi>k</mi><mo>+</mo><mn>1</mn><mo>)</mo><mo>×</mo><mi>k</mi></mrow><annotation encoding="application/x-tex">(k + 1) \times k </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mopen">(</span><span class="mord mathit" style="margin-right:0.03148em;">k</span><span class="mbin">+</span><span class="mord mathrm">1</span><span class="mclose">)</span><span class="mbin">×</span><span class="mord mathit" style="margin-right:0.03148em;">k</span></span></span></span>. In Julia we can generate these using</p> <figure class="highlight"><pre><code class="language-julia" data-lang="julia"><span class="k">function</span><span class="nf"> init</span><span class="x">(</span><span class="n">n</span><span class="x">,</span> <span class="n">dimension</span><span class="x">)</span>
    <span class="n">V</span> <span class="o">=</span> <span class="n">zeros</span><span class="x">(</span><span class="n">n</span><span class="x">,</span> <span class="n">dimension</span> <span class="o">+</span> <span class="mi">1</span><span class="x">)</span>
    <span class="n">H</span> <span class="o">=</span> <span class="n">zeros</span><span class="x">(</span><span class="n">dimension</span> <span class="o">+</span> <span class="mi">1</span><span class="x">,</span> <span class="n">dimension</span><span class="x">)</span>
    <span class="n">v0</span> <span class="o">=</span> <span class="n">rand</span><span class="x">(</span><span class="n">n</span><span class="x">)</span>
    <span class="n">V</span><span class="x">[:,</span> <span class="mi">1</span><span class="x">]</span> <span class="o">=</span> <span class="n">v0</span> <span class="o">/</span> <span class="n">norm</span><span class="x">(</span><span class="n">v0</span><span class="x">)</span>

    <span class="n">V</span><span class="x">,</span> <span class="n">H</span>
<span class="k">end</span>

<span class="k">function</span><span class="nf"> expand</span><span class="o">!</span><span class="x">(</span><span class="n">A</span><span class="x">,</span> <span class="n">V</span><span class="x">,</span> <span class="n">k</span><span class="x">)</span>
    <span class="n">V</span><span class="x">[:,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="x">]</span> <span class="o">=</span> <span class="n">A</span> <span class="o">*</span> <span class="nd">@view</span><span class="x">(</span><span class="n">V</span><span class="x">[:,</span> <span class="n">k</span><span class="x">])</span>
<span class="k">end</span>

<span class="k">function</span><span class="nf"> orthogonalize</span><span class="o">!</span><span class="x">(</span><span class="n">V</span><span class="x">,</span> <span class="n">H</span><span class="x">,</span> <span class="n">k</span><span class="x">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span> <span class="x">:</span> <span class="n">k</span>
        <span class="n">H</span><span class="x">[</span><span class="n">i</span><span class="x">,</span> <span class="n">k</span><span class="x">]</span> <span class="o">=</span> <span class="n">dot</span><span class="x">(</span><span class="nd">@view</span><span class="x">(</span><span class="n">V</span><span class="x">[:,</span> <span class="n">i</span><span class="x">]),</span> <span class="nd">@view</span><span class="x">(</span><span class="n">V</span><span class="x">[:,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="x">]))</span>
        <span class="n">V</span><span class="x">[:,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="x">]</span> <span class="o">-=</span> <span class="n">H</span><span class="x">[</span><span class="n">i</span><span class="x">,</span> <span class="n">k</span><span class="x">]</span> <span class="o">*</span> <span class="nd">@view</span><span class="x">(</span><span class="n">V</span><span class="x">[:,</span> <span class="n">i</span><span class="x">])</span>
    <span class="k">end</span>
    <span class="n">H</span><span class="x">[</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="x">,</span> <span class="n">k</span><span class="x">]</span> <span class="o">=</span> <span class="n">norm</span><span class="x">(</span><span class="nd">@view</span><span class="x">(</span><span class="n">V</span><span class="x">[:,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="x">]))</span>
    <span class="n">V</span><span class="x">[:,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="x">]</span> <span class="o">/=</span> <span class="n">H</span><span class="x">[</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="x">,</span> <span class="n">k</span><span class="x">]</span>
<span class="k">end</span>

<span class="k">function</span><span class="nf"> arnoldi</span><span class="x">(</span><span class="n">A</span><span class="x">,</span> <span class="n">m</span><span class="x">)</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">size</span><span class="x">(</span><span class="n">A</span><span class="x">,</span> <span class="mi">1</span><span class="x">)</span>
    <span class="n">V</span><span class="x">,</span> <span class="n">H</span> <span class="o">=</span> <span class="n">init</span><span class="x">(</span><span class="n">n</span><span class="x">,</span> <span class="n">m</span><span class="x">)</span>

    <span class="k">for</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">1</span> <span class="x">:</span> <span class="n">m</span>
        <span class="n">expand!</span><span class="x">(</span><span class="n">A</span><span class="x">,</span> <span class="n">V</span><span class="x">,</span> <span class="n">k</span><span class="x">)</span>
        <span class="n">orthogonalize!</span><span class="x">(</span><span class="n">V</span><span class="x">,</span> <span class="n">H</span><span class="x">,</span> <span class="n">k</span><span class="x">)</span>
    <span class="k">end</span>

    <span class="n">V</span><span class="x">,</span> <span class="n">H</span>
<span class="k">end</span></code></pre></figure> <p>Now the ordinary Ritz values <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>θ</mi></mrow><annotation encoding="application/x-tex">\theta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.69444em;"></span><span class="strut bottom" style="height:0.69444em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.02778em;">θ</span></span></span></span> are obtained by solving the small eigenvalue problem</p> <p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msubsup><mi>V</mi><mi>k</mi><mi>T</mi></msubsup><mi>A</mi><msub><mi>V</mi><mi>k</mi></msub><mi>y</mi><mo>=</mo><msub><mi>H</mi><mrow><mi>k</mi><mo separator="true">,</mo><mi>k</mi></mrow></msub><mi>y</mi><mo>=</mo><mi>θ</mi><mi>y</mi><mi mathvariant="normal">.</mi></mrow><annotation encoding="application/x-tex"> V_k^TAV_ky = H_{k,k}y = \theta y. </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.8913309999999999em;"></span><span class="strut bottom" style="height:1.177439em;vertical-align:-0.286108em;"></span><span class="base displaystyle textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.22222em;">V</span><span class="vlist"><span style="top:0.247em;margin-left:-0.22222em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit" style="margin-right:0.03148em;">k</span></span></span><span style="top:-0.4129999999999999em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord mathit" style="margin-right:0.13889em;">T</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mord mathit">A</span><span class="mord"><span class="mord mathit" style="margin-right:0.22222em;">V</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.22222em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit" style="margin-right:0.03148em;">k</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="mrel">=</span><span class="mord"><span class="mord mathit" style="margin-right:0.08125em;">H</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.08125em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit" style="margin-right:0.03148em;">k</span><span class="mpunct">,</span><span class="mord mathit" style="margin-right:0.03148em;">k</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="mrel">=</span><span class="mord mathit" style="margin-right:0.02778em;">θ</span><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="mord mathrm">.</span></span></span></span></span></p> <p>Here the square matrix <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>H</mi><mrow><mi>k</mi><mo separator="true">,</mo><mi>k</mi></mrow></msub></mrow><annotation encoding="application/x-tex">H_{k,k}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.969438em;vertical-align:-0.286108em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.08125em;">H</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.08125em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit" style="margin-right:0.03148em;">k</span><span class="mpunct">,</span><span class="mord mathit" style="margin-right:0.03148em;">k</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span> is <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>H</mi><mrow><mi>k</mi><mo>+</mo><mn>1</mn><mo separator="true">,</mo><mi>k</mi></mrow></msub></mrow><annotation encoding="application/x-tex">H_{k+1,k}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.969438em;vertical-align:-0.286108em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.08125em;">H</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.08125em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit" style="margin-right:0.03148em;">k</span><span class="mbin">+</span><span class="mord mathrm">1</span><span class="mpunct">,</span><span class="mord mathit" style="margin-right:0.03148em;">k</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span> with its last row removed. We can compute and plot the Ritz values for each iteration as follows:</p> <figure class="highlight"><pre><code class="language-julia" data-lang="julia"><span class="n">using</span> <span class="n">Plots</span>

<span class="n">ritz</span><span class="x">(</span><span class="n">H</span><span class="x">)</span> <span class="o">=</span> <span class="n">eigvals</span><span class="x">(</span><span class="n">H</span><span class="x">)</span>

<span class="k">function</span><span class="nf"> ritz_example</span><span class="x">(;</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">60</span><span class="x">,</span> <span class="n">m</span> <span class="o">=</span> <span class="mi">30</span><span class="x">)</span>
    <span class="n">A</span> <span class="o">=</span> <span class="n">my_matrix</span><span class="x">(</span><span class="n">n</span><span class="x">)</span>
    <span class="n">V</span><span class="x">,</span> <span class="n">H</span> <span class="o">=</span> <span class="n">arnoldi</span><span class="x">(</span><span class="n">A</span><span class="x">,</span> <span class="n">m</span><span class="x">)</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">plot</span><span class="x">(;</span><span class="n">legend</span> <span class="o">=</span> <span class="x">:</span><span class="n">none</span><span class="x">)</span>

    <span class="k">for</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">1</span> <span class="x">:</span> <span class="n">m</span>
        <span class="n">ritz_values</span> <span class="o">=</span> <span class="n">ritz</span><span class="x">(</span><span class="nd">@view</span><span class="x">(</span><span class="n">H</span><span class="x">[</span><span class="mi">1</span> <span class="x">:</span> <span class="n">k</span><span class="x">,</span> <span class="mi">1</span> <span class="x">:</span> <span class="n">k</span><span class="x">]))</span>
        <span class="n">scatter!</span><span class="x">(</span><span class="n">real</span><span class="x">(</span><span class="n">ritz_values</span><span class="x">),</span> <span class="n">k</span> <span class="o">*</span> <span class="n">ones</span><span class="x">(</span><span class="n">ritz_values</span><span class="x">),</span> <span class="n">marker</span> <span class="o">=</span> <span class="x">(:</span><span class="n">x</span><span class="x">,</span> <span class="x">:</span><span class="n">green</span><span class="x">))</span>
    <span class="k">end</span>
    <span class="n">p</span>
<span class="k">end</span></code></pre></figure> <p>What we get is something like</p> <figure class="full_width_fig"> <img src="/assets/ritz/ritz-32a9cf384ab04b5142e8e3c5aa09e6f4eba4ad23c7b9c6cbb0ef402429c8e0db.svg" alt="ritz/ritz.svg"/> </figure> <p>On the vertical axis we have the iteration (or size of our search space), and horizontally we have the real line. The black stars are the actual eigenvalues, while the green crosses the Ritz values. Now if we were to target interior eigenvalues near <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>τ</mi><mo>=</mo><mn>3</mn></mrow><annotation encoding="application/x-tex">\tau = 3</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.64444em;"></span><span class="strut bottom" style="height:0.64444em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.1132em;">τ</span><span class="mrel">=</span><span class="mord mathrm">3</span></span></span></span>, we can clearly see that many Ritz values start out near this target, but actually converge away from it. This is undesirable for restarts.</p> <p>Enter harmonic Ritz values. As shown in the previous post harmonic Ritz values satisfy the Petrov-Galerkin condition</p> <p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>(</mo><mi>A</mi><mo>−</mo><mi>τ</mi><mi>I</mi><mo>)</mo><mi>z</mi><mo>−</mo><mi>θ</mi><mi>z</mi><mo>⊥</mo><mo>(</mo><mi>A</mi><mo>−</mo><mi>τ</mi><mi>I</mi><mo>)</mo><msub><mi>V</mi><mi>k</mi></msub><mtext><mtext> </mtext><mi mathvariant="normal">f</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">r</mi><mtext> </mtext></mtext><mi>z</mi><mo>=</mo><msub><mi>V</mi><mi>k</mi></msub><mi>y</mi><mi mathvariant="normal">.</mi></mrow><annotation encoding="application/x-tex"> (A - \tau I)z - \theta z \perp (A - \tau I)V_k \text{ for } z = V_k y. </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base displaystyle textstyle uncramped"><span class="mopen">(</span><span class="mord mathit">A</span><span class="mbin">−</span><span class="mord mathit" style="margin-right:0.1132em;">τ</span><span class="mord mathit" style="margin-right:0.07847em;">I</span><span class="mclose">)</span><span class="mord mathit" style="margin-right:0.04398em;">z</span><span class="mbin">−</span><span class="mord mathit" style="margin-right:0.02778em;">θ</span><span class="mord mathit" style="margin-right:0.04398em;">z</span><span class="mrel">⊥</span><span class="mopen">(</span><span class="mord mathit">A</span><span class="mbin">−</span><span class="mord mathit" style="margin-right:0.1132em;">τ</span><span class="mord mathit" style="margin-right:0.07847em;">I</span><span class="mclose">)</span><span class="mord"><span class="mord mathit" style="margin-right:0.22222em;">V</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.22222em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit" style="margin-right:0.03148em;">k</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="text mord displaystyle textstyle uncramped"><span class="mord mspace"> </span><span class="mord mathrm" style="margin-right:0.07778em;">f</span><span class="mord mathrm">o</span><span class="mord mathrm">r</span><span class="mord mspace"> </span></span><span class="mord mathit" style="margin-right:0.04398em;">z</span><span class="mrel">=</span><span class="mord"><span class="mord mathit" style="margin-right:0.22222em;">V</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.22222em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit" style="margin-right:0.03148em;">k</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="mord mathrm">.</span></span></span></span></span></p> <p>Now it’s not hard to verify we can write <span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>(</mo><mi>A</mi><mo>−</mo><mi>τ</mi><mi>I</mi><mo>)</mo><msub><mi>V</mi><mi>k</mi></msub><mo>=</mo><msub><mi>V</mi><mrow><mi>k</mi><mo>+</mo><mn>1</mn></mrow></msub><msubsup><mi>H</mi><mrow><mi>k</mi><mo>+</mo><mn>1</mn><mo separator="true">,</mo><mi>k</mi></mrow><mi>τ</mi></msubsup></mrow><annotation encoding="application/x-tex">(A - \tau I)V_k = V_{k+1}H_{k+1,k}^\tau</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1.133108em;vertical-align:-0.383108em;"></span><span class="base displaystyle textstyle uncramped"><span class="mopen">(</span><span class="mord mathit">A</span><span class="mbin">−</span><span class="mord mathit" style="margin-right:0.1132em;">τ</span><span class="mord mathit" style="margin-right:0.07847em;">I</span><span class="mclose">)</span><span class="mord"><span class="mord mathit" style="margin-right:0.22222em;">V</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.22222em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit" style="margin-right:0.03148em;">k</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mrel">=</span><span class="mord"><span class="mord mathit" style="margin-right:0.22222em;">V</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.22222em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit" style="margin-right:0.03148em;">k</span><span class="mbin">+</span><span class="mord mathrm">1</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mord"><span class="mord mathit" style="margin-right:0.08125em;">H</span><span class="vlist"><span style="top:0.24700000000000003em;margin-left:-0.08125em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit" style="margin-right:0.03148em;">k</span><span class="mbin">+</span><span class="mord mathrm">1</span><span class="mpunct">,</span><span class="mord mathit" style="margin-right:0.03148em;">k</span></span></span></span><span style="top:-0.41300000000000003em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord mathit" style="margin-right:0.1132em;">τ</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span></span> for <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msubsup><mi>H</mi><mrow><mi>k</mi><mo>+</mo><mn>1</mn><mo separator="true">,</mo><mi>k</mi></mrow><mi>τ</mi></msubsup><mo>:</mo><mo>=</mo><msub><mi>H</mi><mrow><mi>k</mi><mo>+</mo><mn>1</mn><mo separator="true">,</mo><mi>k</mi></mrow></msub><mo>−</mo><mi>τ</mi><mi>I</mi></mrow><annotation encoding="application/x-tex">H_{k+1,k}^\tau := H_{k+1,k} - \tau I</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:1.1025459999999998em;vertical-align:-0.4192159999999999em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.08125em;">H</span><span class="vlist"><span style="top:0.2831079999999999em;margin-left:-0.08125em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit" style="margin-right:0.03148em;">k</span><span class="mbin">+</span><span class="mord mathrm">1</span><span class="mpunct">,</span><span class="mord mathit" style="margin-right:0.03148em;">k</span></span></span></span><span style="top:-0.363em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord mathit" style="margin-right:0.1132em;">τ</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mrel">:</span><span class="mrel">=</span><span class="mord"><span class="mord mathit" style="margin-right:0.08125em;">H</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.08125em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit" style="margin-right:0.03148em;">k</span><span class="mbin">+</span><span class="mord mathrm">1</span><span class="mpunct">,</span><span class="mord mathit" style="margin-right:0.03148em;">k</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mbin">−</span><span class="mord mathit" style="margin-right:0.1132em;">τ</span><span class="mord mathit" style="margin-right:0.07847em;">I</span></span></span></span>. Note that the Hessenberg matrix is not square, but by abuse of notation I mean that <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>τ</mi></mrow><annotation encoding="application/x-tex">\tau</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.43056em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.1132em;">τ</span></span></span></span> must be substracted from the diagonal of the Hessenberg matrix. Some more work shows that the Petrov-Galerkin condition is equivalent to solving the generalized eigenvalue problem</p> <p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>(</mo><msubsup><mi>H</mi><mrow><mi>k</mi><mo>+</mo><mn>1</mn><mo separator="true">,</mo><mi>k</mi></mrow><mi>τ</mi></msubsup><msup><mo>)</mo><mo>∗</mo></msup><msubsup><mi>H</mi><mrow><mi>k</mi><mo>+</mo><mn>1</mn><mo separator="true">,</mo><mi>k</mi></mrow><mi>τ</mi></msubsup><mi>y</mi><mo>=</mo><mi>θ</mi><mo>(</mo><msubsup><mi>H</mi><mrow><mi>k</mi><mo separator="true">,</mo><mi>k</mi></mrow><mi>τ</mi></msubsup><msup><mo>)</mo><mo>∗</mo></msup><mi>y</mi><mi mathvariant="normal">.</mi></mrow><annotation encoding="application/x-tex"> (H^\tau_{k+1,k})^* H^\tau_{k+1,k} y = \theta (H^\tau_{k,k})^* y. </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1.133108em;vertical-align:-0.383108em;"></span><span class="base displaystyle textstyle uncramped"><span class="mopen">(</span><span class="mord"><span class="mord mathit" style="margin-right:0.08125em;">H</span><span class="vlist"><span style="top:0.24700000000000003em;margin-left:-0.08125em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit" style="margin-right:0.03148em;">k</span><span class="mbin">+</span><span class="mord mathrm">1</span><span class="mpunct">,</span><span class="mord mathit" style="margin-right:0.03148em;">k</span></span></span></span><span style="top:-0.41300000000000003em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord mathit" style="margin-right:0.1132em;">τ</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mclose"><span class="mclose">)</span><span class="vlist"><span style="top:-0.413em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord">∗</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mord"><span class="mord mathit" style="margin-right:0.08125em;">H</span><span class="vlist"><span style="top:0.24700000000000003em;margin-left:-0.08125em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit" style="margin-right:0.03148em;">k</span><span class="mbin">+</span><span class="mord mathrm">1</span><span class="mpunct">,</span><span class="mord mathit" style="margin-right:0.03148em;">k</span></span></span></span><span style="top:-0.41300000000000003em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord mathit" style="margin-right:0.1132em;">τ</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="mrel">=</span><span class="mord mathit" style="margin-right:0.02778em;">θ</span><span class="mopen">(</span><span class="mord"><span class="mord mathit" style="margin-right:0.08125em;">H</span><span class="vlist"><span style="top:0.24700000000000003em;margin-left:-0.08125em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit" style="margin-right:0.03148em;">k</span><span class="mpunct">,</span><span class="mord mathit" style="margin-right:0.03148em;">k</span></span></span></span><span style="top:-0.41300000000000003em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord mathit" style="margin-right:0.1132em;">τ</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mclose"><span class="mclose">)</span><span class="vlist"><span style="top:-0.413em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord">∗</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="mord mathrm">.</span></span></span></span></span></p> <p>This can be implemented using:</p> <figure class="highlight"><pre><code class="language-julia" data-lang="julia"><span class="k">function</span><span class="nf"> harmonic_ritz</span><span class="x">(</span><span class="n">H</span><span class="x">,</span> <span class="n">f</span><span class="x">,</span> <span class="n">τ</span><span class="x">)</span>
    <span class="n">Hτ</span> <span class="o">=</span> <span class="n">H</span> <span class="o">-</span> <span class="n">UniformScaling</span><span class="x">(</span><span class="n">τ</span><span class="x">)</span>
    <span class="n">A</span> <span class="o">=</span> <span class="n">Hτ</span><span class="err">'</span> <span class="o">*</span> <span class="n">Hτ</span>
    <span class="n">A</span><span class="x">[</span><span class="k">end</span><span class="x">,</span> <span class="k">end</span><span class="x">]</span> <span class="o">+=</span> <span class="n">conj</span><span class="x">(</span><span class="n">f</span><span class="x">)</span> <span class="o">*</span> <span class="n">f</span>
    <span class="n">eigvals</span><span class="x">(</span><span class="n">A</span><span class="x">,</span> <span class="n">Hτ</span><span class="err">'</span><span class="x">)</span> <span class="o">+</span> <span class="n">τ</span>
<span class="k">end</span>

<span class="k">function</span><span class="nf"> harmonic_ritz_example</span><span class="x">(;</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">60</span><span class="x">,</span> <span class="n">m</span> <span class="o">=</span> <span class="mi">30</span><span class="x">)</span>
    <span class="n">A</span> <span class="o">=</span> <span class="n">my_matrix</span><span class="x">(</span><span class="n">n</span><span class="x">)</span>
    <span class="n">V</span><span class="x">,</span> <span class="n">H</span> <span class="o">=</span> <span class="n">arnoldi</span><span class="x">(</span><span class="n">A</span><span class="x">,</span> <span class="n">m</span><span class="x">)</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">plot</span><span class="x">(;</span><span class="n">legend</span> <span class="o">=</span> <span class="x">:</span><span class="n">none</span><span class="x">)</span>

    <span class="k">for</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">1</span> <span class="x">:</span> <span class="n">m</span>
        <span class="n">Hk</span> <span class="o">=</span> <span class="nd">@view</span><span class="x">(</span><span class="n">H</span><span class="x">[</span><span class="mi">1</span> <span class="x">:</span> <span class="n">k</span><span class="x">,</span> <span class="mi">1</span> <span class="x">:</span> <span class="n">k</span><span class="x">]</span>
        <span class="n">harmonic</span> <span class="o">=</span> <span class="n">harmonic_ritz</span><span class="x">(</span><span class="n">Hk</span><span class="x">,</span> <span class="n">H</span><span class="x">[</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="x">,</span> <span class="n">k</span><span class="x">],</span> <span class="n">τ</span><span class="x">))</span>
        <span class="n">scatter!</span><span class="x">(</span><span class="n">real</span><span class="x">(</span><span class="n">harmonic</span><span class="x">),</span> <span class="n">k</span> <span class="o">*</span> <span class="n">ones</span><span class="x">(</span><span class="n">harmonic</span><span class="x">),</span> <span class="n">marker</span> <span class="o">=</span> <span class="x">(:</span><span class="n">x</span><span class="x">,</span> <span class="x">:</span><span class="n">green</span><span class="x">))</span>
    <span class="k">end</span>
    <span class="n">p</span>
<span class="k">end</span></code></pre></figure> <p>And produces harmonic Ritz values like this</p> <figure class="full_width_fig"> <img src="/assets/ritz/harmonic-9fc55860f9da6f84318f8e7ebb6a27193fec82dcaf050d18c996120f0b3ed4a1.svg" alt="ritz/harmonic.svg"/> </figure> <p>The point is that harmonic Ritz values come close to our target <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>τ</mi></mrow><annotation encoding="application/x-tex">\tau</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.43056em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.1132em;">τ</span></span></span></span> only when they converge to an eigenvalue near <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>τ</mi></mrow><annotation encoding="application/x-tex">\tau</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.43056em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.1132em;">τ</span></span></span></span>.</p> <p>For restarts this means that retaining Ritz vectors with Ritz values close to <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>τ</mi></mrow><annotation encoding="application/x-tex">\tau</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.43056em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.1132em;">τ</span></span></span></span> will be a good strategy. In sharp contrast with ordinary Ritz values, where lots of Ritz values near our target are useless to retain, since they are on their way converging to exterior eigenvalues.</p> </div> <div class="article-share"> <a href="" title="Share on Twitter" onclick="window.open('https://twitter.com/home?status=Harmonic Ritz values visualized - http://stoppels.blog/posts/harmonic-ritz-values-visualized ', 'newwindow', 'width=500, height=225'); return false;" data-turbolinks="false"> <svg enable-background="new 0 0 128 128" width="15px" version="1.1" viewBox="0 0 128 128" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><g id="_x37__stroke"><g id="Twitter"><rect clip-rule="evenodd" fill="none" fill-rule="evenodd" height="128" width="128"/><path clip-rule="evenodd" d="M128,23.294 c-4.703,2.142-9.767,3.59-15.079,4.237c5.424-3.328,9.587-8.606,11.548-14.892c-5.079,3.082-10.691,5.324-16.687,6.526 c-4.778-5.231-11.608-8.498-19.166-8.498c-14.493,0-26.251,12.057-26.251,26.927c0,2.111,0.225,4.16,0.676,6.133 C41.217,42.601,21.871,31.892,8.91,15.582c-2.261,3.991-3.554,8.621-3.554,13.552c0,9.338,4.636,17.581,11.683,22.412 c-4.297-0.131-8.355-1.356-11.901-3.359v0.331c0,13.051,9.053,23.937,21.074,26.403c-2.201,0.632-4.523,0.948-6.92,0.948 c-1.69,0-3.343-0.162-4.944-0.478c3.343,10.694,13.035,18.483,24.53,18.691c-8.986,7.227-20.315,11.533-32.614,11.533 c-2.119,0-4.215-0.123-6.266-0.37c11.623,7.627,25.432,12.088,40.255,12.088c48.309,0,74.717-41.026,74.717-76.612 c0-1.171-0.023-2.342-0.068-3.49C120.036,33.433,124.491,28.695,128,23.294" fill-rule="evenodd" id="Twitter_1_"/></g></g></svg> </a> <a href="" title="Share on Facebook" onclick="window.open('https://www.facebook.com/sharer/sharer.php?u=http://stoppels.blog/posts/harmonic-ritz-values-visualized', 'newwindow', 'width=500, height=500'); return false;" data-turbolinks="false"> <svg enable-background="new 0 0 128 128" width="15px" version="1.1" viewBox="0 0 128 128" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><g id="_x31__stroke"><g id="Facebook_1_"><rect fill="none" height="128" width="128"/><path clip-rule="evenodd" d="M68.369,128H7.065C3.162,128,0,124.836,0,120.935 V7.065C0,3.162,3.162,0,7.065,0h113.871C124.837,0,128,3.162,128,7.065v113.87c0,3.902-3.163,7.065-7.064,7.065H88.318V78.431 h16.638l2.491-19.318H88.318V46.78c0-5.593,1.553-9.404,9.573-9.404l10.229-0.004V20.094c-1.769-0.235-7.841-0.761-14.906-0.761 c-14.749,0-24.846,9.003-24.846,25.535v14.246H51.688v19.318h16.681V128z" fill-rule="evenodd" id="Facebook"/></g></g></svg> </a> <a href="" title="Share on Google+" onclick="window.open('https://plus.google.com/share?url=http://stoppels.blog/posts/harmonic-ritz-values-visualized', 'newwindow', 'width=550, height=400'); return false;" data-turbolinks="false"> <svg enable-background="new 0 0 128 128" version="1.1" viewBox="0 0 128 128" width="20px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><g id="_x35__stroke"><g id="Google_Plus"><rect clip-rule="evenodd" fill="none" fill-rule="evenodd" height="128" width="128"/><path clip-rule="evenodd" d="M40.654,55.935v16.13 c0,0,15.619-0.021,21.979-0.021C59.189,82.5,53.834,88.194,40.654,88.194c-13.338,0-23.748-10.832-23.748-24.194 s10.41-24.194,23.748-24.194c7.052,0,11.607,2.483,15.784,5.944c3.344-3.35,3.065-3.828,11.573-11.877 c-7.222-6.586-16.822-10.6-27.357-10.6C18.201,23.273,0,41.507,0,64c0,22.493,18.201,40.727,40.654,40.727 c33.561,0,41.763-29.275,39.044-48.792H40.654z M113.912,56.742V42.628h-10.063v14.113H89.358v10.081h14.491v14.517h10.063V66.823 H128V56.742H113.912z" fill-rule="evenodd" id="Google_Plus_1_"/></g></g></svg> </a> </div> </article> <footer class="footer"> <p>Copyright © Harmen Stoppels 2016 - 2017</p> </footer> </div> </div> </main> <script>
window.ga=function(){ga.q.push(arguments)};ga.q=[];ga.l=+new Date;
ga('create','UA-93471447-1','auto');ga('send','pageview')
</script> <script src="https://www.google-analytics.com/analytics.js" async defer></script> </body> </html>